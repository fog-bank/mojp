<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:local="clr-namespace:Mojp"
		x:Class="Mojp.MainWindow"
		Title="MO 日本語テキストプレビュー" MinWidth="200" MinHeight="40" Topmost="{Binding TopMost, Mode=OneTime}"
		Width="{Binding WindowWidth, Mode=TwoWay}" Height="{Binding WindowHeight, Mode=TwoWay}" 
		Left="{Binding WindowLeft, Mode=TwoWay}" Top="{Binding WindowTop, Mode=TwoWay}"
		Icon="Resources/dictionary.ico" SnapsToDevicePixels="True" Initialized="OnInitialized">
	<!-- WindowStyle="None" AllowsTransparency="True" Background="Transparent" -->
	<Window.DataContext>
		<local:MainViewModel />
	</Window.DataContext>
	<Border>
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition />
			</Grid.RowDefinitions>
			<TabControl Grid.RowSpan="2" FontFamily="{Binding FontFamily}" FontSize="{Binding FontSize}" 
						ItemsSource="{Binding Cards}" SelectedIndex="{Binding SelectedIndex}">
				<TabControl.ItemTemplate>
					<DataTemplate DataType="local:Card">
						<TextBlock Margin="2" MinHeight="14" Text="{Binding JapaneseName}">
							<TextBlock.ToolTip>
								<TextBlock><Run Text="{Binding JapaneseName}" /> / <Run Text="{Binding Name}" /></TextBlock>
							</TextBlock.ToolTip>
							<TextBlock.Style>
								<Style TargetType="TextBlock">
									<Style.Triggers>
										<DataTrigger Binding="{Binding Name}" Value="{x:Null}">
											<Setter Property="Width" Value="40" />
											<Setter Property="Visibility" Value="Hidden" />
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBlock.Style>
						</TextBlock>
					</DataTemplate>
				</TabControl.ItemTemplate>
				<TabControl.ContentTemplate>
					<DataTemplate DataType="local:Card">
						<Grid Margin="2">
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto" />
								<RowDefinition />
								<RowDefinition Height="Auto" />
							</Grid.RowDefinitions>
							<TextBlock Margin="2" Text="{Binding Type}" ToolTip="{Binding Type}" TextTrimming="CharacterEllipsis">
								<TextBlock.Style>
									<Style TargetType="TextBlock">
										<Style.Triggers>
											<DataTrigger Binding="{Binding Type}" Value="{x:Null}">
												<Setter Property="Visibility" Value="Collapsed" />
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</TextBlock.Style>
							</TextBlock>
							<ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
								<TextBlock Margin="2" Text="{Binding Text}" TextWrapping="Wrap" />
							</ScrollViewer>
							<TextBlock Grid.Row="2" Margin="2" Text="{Binding PT}" TextTrimming="CharacterEllipsis">
								<TextBlock.Style>
									<Style TargetType="TextBlock">
										<Style.Triggers>
											<DataTrigger Binding="{Binding PT}" Value="{x:Null}">
												<Setter Property="Visibility" Value="Collapsed" />
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</TextBlock.Style>
							</TextBlock>
						</Grid>
					</DataTemplate>
				</TabControl.ContentTemplate>
			</TabControl>
			<ToolBar Margin="0,2,2,0" HorizontalAlignment="Right" VerticalAlignment="Center">
				<ToolBar.Template>
					<ControlTemplate TargetType="ToolBar">
						<ItemsPresenter />
					</ControlTemplate>
				</ToolBar.Template>
				<ToolBar.ItemsPanel>
					<ItemsPanelTemplate>
						<StackPanel Orientation="Horizontal" />
					</ItemsPanelTemplate>
				</ToolBar.ItemsPanel>
				<Button FontFamily="Segoe MDL2 Assets" Content="&#xe114;" FontSize="14" ToolTip="MO をキャプチャ" Click="OnCapture" />
				<Button FontFamily="Segoe MDL2 Assets" Content="&#xe713;" FontSize="14" ToolTip="設定" Click="OnOption" />
				<!--<Button FontFamily="Marlett" Content="q" FontSize="14" ToolTip="最小化" Click="OnWindowMinimize" />-->
				<!--<Button FontFamily="Marlett" Content="r" FontSize="14" ToolTip="閉じる" Click="OnWindowClose" />-->
			</ToolBar>
			<Grid Name="imgLoading" Grid.RowSpan="2" Background="#7Fffffff" Visibility="Collapsed">
				<Path Stroke="#7f505096" HorizontalAlignment="Center" VerticalAlignment="Center">
					<!-- http://blogs.microsoft.co.il/blogs/maxim/archive/2008/03/08/wpf-daily-tip-simple-wait-progress-control-continuous-animation.aspx -->
					<Path.Data>
						<GeometryGroup>
							<EllipseGeometry Center="34,34" RadiusX="32" RadiusY="32" />
							<EllipseGeometry Center="34,34" RadiusX="20" RadiusY="20" />
						</GeometryGroup>
					</Path.Data>
					<Path.Fill>
						<LinearGradientBrush EndPoint="0,1">
							<GradientStop Color="#ff4dd5ce" />
							<GradientStop Offset="1" Color="#ff499692" />
						</LinearGradientBrush>
					</Path.Fill>
					<Path.RenderTransform>
						<RotateTransform CenterX="34" CenterY="34" />
					</Path.RenderTransform>
					<Path.Style>
						<Style TargetType="Path">
							<Style.Triggers>
								<DataTrigger Binding="{Binding Visibility, ElementName=imgLoading}" Value="Visible">
									<DataTrigger.EnterActions>
										<BeginStoryboard Name="startWaitRing">
											<Storyboard RepeatBehavior="Forever">
												<DoubleAnimation Storyboard.TargetProperty="RenderTransform.Angle" Duration="0:0:1" From="0" To="360" />
											</Storyboard>
										</BeginStoryboard>
									</DataTrigger.EnterActions>
									<DataTrigger.ExitActions>
										<StopStoryboard BeginStoryboardName="startWaitRing" />
									</DataTrigger.ExitActions>
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</Path.Style>
				</Path>
			</Grid>
		</Grid>
	</Border>
	<Window.ContextMenu>
		<ContextMenu>
			<MenuItem Header="MO をキャプチャ" Click="OnCapture" />
			<MenuItem Header="カード名をコピー" Click="OnCopyCardName">
				<MenuItem.Icon>
					<Image Source="Resources\Copy.png" />
				</MenuItem.Icon>
			</MenuItem>
			<MenuItem Header="カードを MTG Wiki で調べる" Click="OnGoToWiki">
				<MenuItem.Icon>
					<Image Source="Resources\Web.png" />
				</MenuItem.Icon>
			</MenuItem>
			<Separator />
			<MenuItem Header="5 秒間隠す" Click="OnHide" />
			<MenuItem Header="設定" Click="OnOption" />
			<MenuItem Header="最小化" Click="OnWindowMinimize" />
			<MenuItem Header="終了" Click="OnWindowClose" />
		</ContextMenu>
	</Window.ContextMenu>
</Window>
